<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>PseudoDF</title>

    <!-- ICON -->
    <!-- <link rel="icon" type="image/png" href="icon.png"> -->

    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }

        textarea {
            width: 30%;
            height: 200px;
            margin-right: 10px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 10px;
            padding: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 5px;
            margin-right: 15px;
        }

        #editorContainer {
            width: 100%;
            height: 800px;
            border: 1px solid #444;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            font-size: 1.0rem;

        }

        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            transition: opacity .2s ease;
            
            background: #222;
            border: 1px solid #444;
            color: #ddd;
            padding: 5px 10px;
            border-radius: 4px;
            text-align: left;

            position: fixed;
            top: 10%;
            left: 5%;
            transform: translateX(0%);
            max-width: calc(100vw - 20px);
            box-sizing: border-box;
            z-index: 999;
        }

        .tooltip:hover .tooltip-text {
            top: calc(var(--tooltip-top) + 10px);
            visibility: visible;
            opacity: 1;
        }

        #settingsWrapper {
            display: inline-block;
            position: relative;
            margin-bottom: 5px;
        }

        #settingsToggle {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #settingsPanel {
            background: #ddd;
            padding: 10px 15px;
            border-radius: 6px;
            width: max-content;
            border: 1px solid #aaa;
            margin-top: 5px;

            position: absolute;
            z-index: 1000;

            max-height: 500px;
            opacity: 1;
            transition: opacity .15s ease, transform .15s ease;
        }

        #settingsPanel.hidden {
            opacity: 0;
            transform: translateY(-5px);
            pointer-events: none;
        }

        #settingsPanel label {
            cursor: pointer;
            font-size: 14px;
        }
    </style>

</head>
<body>

<h1>PseudoDF</h1>

<h3>
    Input:
    <div class="tooltip">
        ðŸ›ˆ
        <span class="tooltip-text">
            To import DiamondFire code, get the NBT data of as many templates as you want, paste them into the input boxes and click <b>Process Code</b><br>
            <br>
            In order to get the NBT data from DiamondFire:<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- Look at a Function, Process or Event block<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- Shift + Right Click to get an item<br>
            &nbsp;&nbsp;&nbsp;&nbsp;- Hold the item and do <b>/i nbt</b><br>
            &nbsp;&nbsp;&nbsp;&nbsp;- Copy the data from the chat
        </span>
    </div>
</h3>



<div id="inputs-container">
</div>

<button id="processBtn" onclick="processAllCode()" disabled>Process Code</button>
<div id="settingsWrapper">
    <button id="settingsToggle">Advanced Settings â–¾</button>

    <div id="settingsPanel" class="hidden">
        <label><input type="checkbox" data-setting="shortScopes"> Short Variable Scopes</label><br>
        <label><input type="checkbox" data-setting="lineScopeDefault"> Don't Specify Line Scope</label><br>
        <br>
        <label><input type="checkbox" data-setting="showAllTags"> Show All Block Tags</label><br>
        <br>
        <label><input type="checkbox" data-setting="noCustomSintax"> No Special Syntax for Set Variable or If Variable</label><br>
        <br>
        <label><input type="checkbox" data-setting="keepVariableNameSpaces"> Keep Spaces in Variable Names</label><br>
        <label><input type="checkbox" data-setting="encapsulateAllNames"> Encapsulate All Names in `Backticks`</label><br>
    </div>
</div>
<br><br>
<button onclick="shareAndCopy()">Share as Link</button>
<button onclick="copyCode()">Copy Code</button>

<br><br>
<h3>Output:</h3>
<div id="editorContainer"></div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

<script>
settings = {
    shortScopes: false,
    lineScopeDefault: false,
    showAllTags: false,
    noCustomSintax: false,
    keepVariableNameSpaces: false,
    encapsulateAllNames: false
};

document.getElementById("settingsToggle").addEventListener("click", () => {
    const panel = document.getElementById("settingsPanel");
    panel.classList.toggle("hidden");
});

document.querySelectorAll('.tooltip').forEach(tip => {
    tip.addEventListener('mouseenter', () => {
        const rect = tip.getBoundingClientRect();
        tip.style.setProperty('--tooltip-top', rect.bottom + 'px');
    });
});

codeMessages = {
    default: '// Output will be here',
    error: '// An error occoured\n// Please make sure all inputs are valid\n// Check the console for more info',
    success: '// Code processed successfully\n// You can edit it before sharing it',
    processCode: '// Error\n// Paste NBT data and process it before sharing'
};

settings = {}; // TODO

function processAllCode() {
    const boxes = inputs;
    let output = '';
    for (let box of boxes) {
        const text = box.value;
        const processed = processAll(text);
        output += '\n\n' + processed;
    }
    console.log(boxes);
    console.log(output);

    if (output.trim() === '') {
        editor.setValue(codeMessages.error);
        return;
    }

    editor.setValue(codeMessages.success + output);
}

async function copyCode() {
    const code = editor.getValue();
    await navigator.clipboard.writeText(code);
    showCopiedToast("Code copied to clipboard");
}
</script>

<script src="script.js"></script>
<script src="load_tags.js"></script>
<script src="monaco_editor.js"></script>
<script src="input_boxes_handler.js"></script>
<script src="link_handler.js"></script>

</body>
</html>
